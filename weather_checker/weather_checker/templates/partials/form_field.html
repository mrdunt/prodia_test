{% load images static %}

<div class="form-group mb-4">
    <label class="{% if field.is_hidden or field.widget_type == 'checkbox' %}d-none{% endif %}">
        {{field.label}} {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
    </label>
    {% if field.widget_type == 'selectmultiple' %}
        {% if field.field.widget.attrs.readonly %}
            <select class="choices select-multiple choices-disabled" multiple="multiple" id="{{field.id}}" name="{{field.name}}">
                {% for set in field.field.queryset %}
                    <option value="{{set.id}}" {% if set.id in field.field.initial %}selected{% else %}disabled{% endif %}>{{set}}</option>
                {% endfor %}
            </select>
        {% else %}
            <select class="choices form-select choices-select" multiple="multiple" name="{{field.name}}">
                {% for set in field.field.queryset %}
                    {% if field.value %}
                        <option value="{{set.id}}" {% for value in field.value %}{% if set.id == value|add:"0" %}selected{% endif %}{% endfor %}>{{set}}</option>
                    {% else %}
                        <option value="{{set.id}}">{{set}}</option>
                    {% endif %}
                {% endfor %}
            </select>
        {% endif %}
    {% elif field.widget_type == 'radioselect' %}
        <div class="position-relative">
            {% for set in field.field.choices %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="{{field.name}}" value="{{set.0}}" {% if set.0 == field.value %}checked{% endif %}>
                    <label class="form-check-label">{{set.1}}</label>
                </div>
            {% endfor %}
        </div>
    {% elif field.widget_type == 'select' %}
        <select name="{{field.name}}" class="form-select" id="id-{{field.name}}">
            {% if field.field.widget.attrs.readonly %}
                {% for set in field.field.choices %}
                    <option value="{{set.0}}" {% if set.0 == field.value %}selected{% else %}hidden{% endif %}>{{set.1}}</option>
                {% endfor %}
            {% else %}
                {% for set in field.field.choices %}
                    <option value="{{set.0}}" {% if set.0|stringformat:"s" == field.value|stringformat:"s" %}selected{% endif %}>{{set.1}}</option>
                {% endfor %}
            {% endif %}
        </select>
    {% elif field.widget_type == 'checkbox' %}
        <div class="form-check">
            <input name="{{field.name}}" class="form-check-input" type="checkbox" id="flexCheckDefault"
            {% if field.value %}checked=checked {% endif %} {% if field.field.widget.attrs.readonly %}disabled="disabled"{% endif %}>
            <label>{{field.label}}</label>
        </div>
    {% elif field.widget_type == 'textarea' %}
        <textarea name="{{field.name}}" class="form-control {% if field.errors %}is-invalid{% endif %}"
            value="{% if field.value is not null %}{{field.value}}{% endif %}"
            {% if field.field.required %}required{% endif %}>{% if field.value is not null %}{{field.value}}{% endif %}</textarea>
    {% else %}
        <input
            {% if field.widget_type == 'clearablefile' %}
                type="file"
                class="form-control form-control-file {% if field.errors %}is-invalid{% endif %}"
                id="id-{{field.name}}"
            {% else %}
                type="{{field.widget_type}}"
                class="form-control {% if field.errors %}is-invalid{% endif %}"
            {% endif %}

            name="{{field.name}}"

            {% if field.widget_type == 'number' %}
                step="any"
            {% endif %}

            {% if field.field.widget.attrs.id is not null %}
                id="{{ field.field.widget.attrs.id }}"
            {% else %}
                id="id-{{field.name}}"
            {% endif %}

            {% if field.widget_type == 'date' %}
                value="{% if field.value|date:"Y-m-d" %}{{field.value|date:"Y-m-d"}}{% else %}{{field.value}}{% endif %}"
            {% elif field.name|stringformat:"s" == "latitude" or field.name|stringformat:"s" == "longitude" %}
                value="{{ field.value|default_if_none:"" }}"
            {% elif field.field.widget.attrs.price %}
                value="{% if field.value is not null %}{{field.value|floatformat:'0'}}{% endif %}"
            {% else %}
                value="{% if field.value is not null or field.value|length > 0 %}{{field.value}}{% endif %}"
            {% endif %}
            {% if field.field.required %}required{% endif %}
            {% if field.field.widget.attrs.readonly %}readonly{% endif %}
            
        >
        {% if field.help_text %}
            <span class="helptext">{{field.help_text}}</span>
            <br>
        {% endif %}

        {% if field.widget_type == 'clearablefile' %}
            {% if preview != 'none' %}
                <img id="image-{{field.name}}" class="mt-3 logo-responsive" 
                    {% if field.value is not null %}
                        src="{% thumbnail_generator field.value 'size_120x120' %}"
                    {% endif %}
                />
                <script>
                    document.getElementById('id-{{field.name}}').onchange = function () {
                        var src = URL.createObjectURL(this.files[0])
                        let file = this.files[0];
                        var file_size = "{{file_size}}";
                        if (!/\.(jpe?g|png|gif)$/i.test(file.name)) {
                            return alert(file.name + " is not an image");
                        } else if(file.size > (file_size*1024)){
                            return alert(`File harus lebih kecil dari ${file_size/1000} MB`);
                        } else{
                            document.getElementById('image-{{field.name}}').src = src
                        }
                    }
                </script>
            {% endif %}
        {% endif %}
    {% endif %}

    {% if field.errors %}
        <div class="invalid-feedback d-block">
            <i class="bx bx-radio-circle"></i>
            {{field.errors}}
        </div>
    {% endif %}
</div>